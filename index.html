<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHB Pro - Engineering & Surveying</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <aside class="sidebar" id="sidebar">
        <div class="logo-area">
            <div class="logo-icon"><i class="fa-solid fa-drafting-compass"></i></div>
            <div class="logo-text">
                <h1>SHB Pro</h1>
                <span>Engineering & Surveying</span>
            </div>
        </div>

        <nav>
            <div class="nav-section">
                <div class="nav-title" data-i18n="sec_general">عام</div>
                <button class="nav-btn active" onclick="nav('home')"><i class="fa-solid fa-house"></i> <span data-i18n="nav_home">الرئيسية</span></button>
                <button class="nav-btn" onclick="nav('ai')"><i class="fa-solid fa-robot"></i> <span data-i18n="nav_>الذكاء الاصطناعي</span></button>
                <button class="nav-btn" onclick="nav('units')"><i class="fa-solid fa-arrows-left-right"></i> <span data-i18n="nav_units">محول الوحدات</span></button>
            </div>

            <div class="nav-section">
                <div class="nav-title" data-i18n="sec_survey">مساحة</div>
                <button class="nav-btn" onclick="nav('polygon')"><i class="fa-solid fa-draw-polygon"></i> <span data-i18n="nav_poly">تصحيح المضلع</span></button>
                <button class="nav-btn" onclick="nav('area-coord')"><i class="fa-solid fa-map-location-dot"></i> <span data-i18n="nav_area_coord">مساحة بالإحداثيات</span></button>
                <button class="nav-btn" onclick="nav('angles')"><i class="fa-solid fa-rotate"></i> <span data-i18n="nav_ang">محول الزوايا</span></button>
                <button class="nav-btn" onclick="nav('simple-errors')"><i class="fa-solid fa-chart-line"></i> <span data-i18n="nav_err_s">أخطاء (بسيطة)</span></button>
                <button class="nav-btn" onclick="nav('weighted-errors')"><i class="fa-solid fa-scale-balanced"></i> <span data-i18n="nav_err_w">أخطاء (وزنية)</span></button>
                <button class="nav-btn" onclick="nav('grid-leveling')"><i class="fa-solid fa-border-none"></i> <span data-i18n="nav_grid">شبكة المناسيب</span></button>
                <button class="nav-btn" onclick="nav('leveling')"><i class="fa-solid fa-chart-line"></i> <span data-i18n="nav_leveling">جدول التسوية</span></button>
                <button class="nav-btn" onclick="nav('geodetic')"><i class="fa-solid fa-earth-americas"></i> <span data-i18n="nav_geodetic">محول الإحداثيات</span></button>
                <button class="nav-btn" onclick="nav('stadia')"><i class="fa-solid fa-ruler-combined"></i> <span data-i18n="nav_stadia">حاسبة المسافة</span></button>
            </div>

            <div class="nav-section">
                <div class="nav-title" data-i18n="sec_const">إنشاءات</div>
                <button class="nav-btn" onclick="nav('concrete')"><i class="fa-solid fa-truck-mixer"></i> <span data-i18n="nav_conc">خرسانة</span></button>
                <button class="nav-btn" onclick="nav('plaster')"><i class="fa-solid fa-trowel"></i> <span data-i18n="nav_plaster">قصارة</span></button>
                <button class="nav-btn" onclick="nav('brick')"><i class="fa-solid fa-cubes-stacked"></i> <span data-i18n="nav_brick">طوب</span></button>
                <button class="nav-btn" onclick="nav('tiles')"><i class="fa-solid fa-border-all"></i> <span data-i18n="nav_tile">بلاط</span></button>
            </div>

            <div class="nav-section">
                <div class="nav-title" data-i18n="sec_geo">هندسة متكاملة</div>
                <button class="nav-btn" onclick="nav('geo-2d')"><i class="fa-regular fa-square"></i> <span data-i18n="nav_g2d">أشكال 2D</span></button>
                <button class="nav-btn" onclick="nav('geo-3d')"><i class="fa-solid fa-cube"></i> <span data-i18n="nav_g3d">مجسمات 3D</span></button>
                <button class="nav-btn" onclick="nav('physics')"><i class="fa-solid fa-atom"></i> <span data-i18n="nav_physics">المختبر الفيزيائي</span></button>
            </div>

            <div class="nav-section" style="margin-top: auto; border-top: 1px solid var(--border); padding-top: 15px;">
                <div class="nav-title">إعدادات ومعلومات</div>
                <button class="nav-btn" onclick="nav('profile')"><i class="fa-solid fa-user-gear"></i> <span data-i18n="nav_profile">المستخدم</span></button>
                <button class="nav-btn" onclick="nav('developer')"><i class="fa-solid fa-code"></i> <span data-i18n="nav_dev">المطور</span></button>
            </div>
        </nav>
    </aside>

    <div class="main-wrapper">
    
        <header class="top-bar">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="menu-toggle" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></button>
                <h2 id="page-title" style="font-size:1.1rem; font-weight:bold;">SHB Pro</h2>
            </div>
            
            <div class="controls">
                <button class="icon-btn font-ctrl" onclick="resizeFont(1)" title="Increase Font">A+</button>
                <button class="icon-btn font-ctrl" onclick="resizeFont(-1)" title="Decrease Font">A-</button>
                <div style="width:1px; height:20px; background:var(--border); margin:0 5px;"></div>
                
                <div class="user-widget" id="header-user" onclick="nav('profile')">
                    <span style="font-size:0.9rem;" id="header-username">Guest</span>
                    <div class="user-avatar"><i class="fa-solid fa-user"></i></div>
                </div>
 
                <div style="width:1px; height:20px; background:var(--border); margin:0 10px;"></div>
                <button class="icon-btn" onclick="toggleTheme()" title="Theme"><i class="fa-solid fa-circle-half-stroke"></i></button>
                <button class="icon-btn" onclick="toggleLang()" title="Language"><i class="fa-solid fa-globe"></i></button>
            </div>
        </header>

        <div class="content-area">

            <div id="home" class="page active">
                <div class="card" style="text-align:center; padding: 60px 20px;">
                    <i class="fa-solid fa-drafting-compass" style="font-size:4rem; color:var(--primary); margin-bottom:20px;"></i>
                    <h1 style="margin-bottom:10px;">SHB Pro</h1>
                    <p style="color:var(--text-muted); font-size:1.1rem; max-width:600px; margin:0 auto;" data-i18n="welcome_msg">أقوى أداة للحسابات الهندسية، المساحية، والإنشائية.</p>
                    <p style="margin-top:20px; font-weight:bold; color:var(--success);" id="welcome-user-msg"></p>
                    
                    <div class="stats-grid" style="margin-top:50px; max-width:800px; margin-left:auto; margin-right:auto;">
                        <div class="stat-box" onclick="nav('polygon')" style="cursor:pointer">
                            <i class="fa-solid fa-draw-polygon" style="font-size:2rem; margin-bottom:10px; color:var(--primary);"></i>
                            <div class="lbl" data-i18n="nav_poly">المضلعات</div>
                        </div>
                        <div class="stat-box" onclick="nav('area-coord')" style="cursor:pointer">
                            <i class="fa-solid fa-map-location-dot" style="font-size:2rem; margin-bottom:10px; color:var(--primary);"></i>
                            <div class="lbl" data-i18n="nav_area_coord">مساحة إحداثيات</div>
                        </div>
                        <div class="stat-box" onclick="nav('geo-2d')" style="cursor:pointer">
                            <i class="fa-regular fa-square" style="font-size:2rem; margin-bottom:10px; color:var(--primary);"></i>
                            <div class="lbl" data-i18n="nav_g2d">حاسبة الأشكال</div>
                        </div>
                        <div class="stat-box" onclick="nav('tiles')" style="cursor:pointer">
                            <i class="fa-solid fa-border-all" style="font-size:2rem; margin-bottom:10px; color:var(--primary);"></i>
                            <div class="lbl" data-i18n="nav_tile">البلاط</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profile" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-user-gear"></i> <span data-i18n="profile_title">إعدادات المستخدم</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label data-i18n="lbl_name">الاسم</label>
                            <input type="text" id="user-name" class="form-control" placeholder="Your Name">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_job">المسمى الوظيفي</label>
                            <input type="text" id="user-job" class="form-control" placeholder="Civil Engineer / Surveyor">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_email">البريد الإلكتروني</label>
                            <input type="email" id="user-email" class="form-control" placeholder="example@email.com">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_phone">رقم الهاتف</label>
                            <input type="tel" id="user-phone" class="form-control" placeholder="+962 7...">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_address">العنوان</label>
                            <input type="text" id="user-address" class="form-control" placeholder="City, Country">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveProfile()" style="width:auto;"><i class="fa-solid fa-save"></i> <span data-i18n="btn_save">حفظ الإعدادات</span></button>
                </div>
            </div>

            <div id="developer" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-code"></i> <span data-i18n="dev_title">معلومات المطور</span></h2>
                    </div>
                    <div class="dev-header">
                        <div class="dev-img-placeholder"><i class="fa-solid fa-user-tie"></i></div>
                        <h3 style="color: var(--primary);">Basil Aljbour | باسل الجبور</h3>
                        <p style="color: var(--text-muted);" data-i18n="dev_subtitle">مطور تطبيقات الهندسة والمساحة</p>
                    </div>
                    <div style="max-width: 600px; margin: 0 auto;">
                        <ul class="contact-list">
                            <li><i class="fa-solid fa-envelope"></i> <span>SHBproapp@gmail.com</span></li>
                            <li><i class="fa-brands fa-instagram"></i> <a href="https://www.instagram.com/basil.aljbour?igsh=N3RqdzczdmQyZmF1" target="_blank" style="color: inherit; text-decoration: none;">Basil Aljbour (Instagram)</a></li>
                            <li><i class="fa-brands fa-whatsapp"></i> <span>+962 7 8222 4351</span></li>
                            <li><i class="fa-solid fa-location-dot"></i> <span>Amman, Jordan</span></li>
                        </ul>
                        <div style="text-align: center; margin-top: 20px; color: var(--text-muted); font-size: 0.9rem;">
                            <p data-i18n="dev_desc">تطوير حلول هندسية مبتكرة لتبسيط العمليات الحسابية المعقدة</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ai-box" style="background: #1e2530; padding: 25px; border-radius: 15px; border: 1px solid #ffa500; text-align: center;">
    <i class="fas fa-robot" style="font-size: 40px; color: #ffa500; margin-bottom: 15px;"></i>
    <h3 style="color: white; margin-bottom: 10px;">مساعد SHB الهندسية الذكي</h3>
    
    <div id="chat-output" style="height: 200px; overflow-y: auto; background: #0d1117; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: right; direction: rtl; border: 1px solid #333; color: white; font-size: 14px;">
        <p style="color: #888;">أهلاً بك! اسألني عن الـ GPS أو الحسابات الهندسية من كتب د. جمعة داود.</p>
    </div>

    <div style="display: flex; gap: 8px;">
        <input type="text" id="user-question" placeholder="اكتب سؤالك هنا..." 
               style="flex: 1; padding: 10px; border-radius: 8px; border: none; background: #2c3440; color: white; outline: none;">
        <button onclick="askAI()" style="background: #ffa500; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">إرسال</button>
    </div>
</div>

            <!-- قسم المساحة بالإحداثيات -->
            <div id="area-coord" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-map-location-dot"></i> <span data-i18n="nav_area_coord">حساب المساحة والإحداثيات</span></h2>
                    </div>
                    
                    <p style="margin-bottom:15px; color:var(--text-muted)" data-i18n="area_desc">أدخل إحداثيات النقاط (X, Y) لحساب المساحة والمحيط بدقة ورسم الشكل.</p>

                    <div class="table-container">
                        <table id="areaTable">
                            <thead>
                                <tr>
                                    <th data-i18n="tbl_pt">النقطة</th>
                                    <th data-i18n="tbl_east">Easting (X)</th>
                                    <th data-i18n="tbl_north">Northing (Y)</th>
                                    <th data-i18n="tbl_act">إجراء</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-add" onclick="addAreaRow()"><i class="fa-solid fa-plus"></i> <span data-i18n="btn_add_pt">إضافة نقطة</span></button>
                        <button class="btn btn-primary" onclick="calcAreaCoord()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc_draw">حساب المساحة والمحيط</span></button>
                    </div>
                </div>

                <div id="area-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-val" id="res-area-m2">0</div>
                            <div class="stat-lbl" data-i18n="lbl_area_m2">المساحة (متر مربع)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="res-area-perimeter">0</div>
                            <div class="stat-lbl" data-i18n="lbl_area_perimeter">المحيط (متر)</div>
                        </div>
                    </div>

                    <h3 style="color:var(--primary); margin:25px 0 15px;" data-i18n="graph_area">رسم قطعة الأرض</h3>
                    <canvas id="areaCanvas" width="800" height="500"></canvas>
                    
                    <div class="export-actions">
                        <button class="btn btn-export bg-excel" onclick="exportAreaExcel()"><i class="fa-solid fa-file-excel"></i> Excel (CSV)</button>
                    </div>
                </div>
            </div>

            <!-- قسم تصحيح المضلع -->
            <div id="polygon" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-draw-polygon"></i> <span data-i18n="poly_title">تصحيح المضلع (Bowditch)</span></h2>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label data-i18n="lbl_start_e">إحداثيات البداية (Easting X)</label>
                            <input type="number" id="start-E" class="form-control" value="1000.000">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_start_n">إحداثيات البداية (Northing Y)</label>
                            <input type="number" id="start-N" class="form-control" value="1000.000">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_unit">وحدة الزوايا</label>
                            <select id="poly-unit" class="form-control">
                                <option value="deg">Degrees (Decimal)</option>
                                <option value="dms">DMS (Deg Min Sec)</option>
                                <option value="grad">Gradians (Gon)</option>
                                <option value="rad">Radians</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_start_az">انحراف الضلع الأول (Azimuth)</label>
                            <input type="text" id="start-Az" class="form-control" value="0" placeholder="0 or 45 30 15">
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="polyTable">
                            <thead>
                                <tr>
                                    <th data-i18n="tbl_pt">النقطة</th>
                                    <th data-i18n="tbl_ang_obs">الزاوية المرصودة</th>
                                    <th data-i18n="tbl_len">الطول (m)</th>
                                    <th data-i18n="tbl_act">إجراء</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-add" onclick="addPolyRow()"><i class="fa-solid fa-plus"></i> <span data-i18n="btn_add">إضافة ضلع</span></button>
                        <button class="btn btn-primary" onclick="calcPolygon()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">تحليل وتصحيح</span></button>
                    </div>
                </div>

                <div id="poly-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-val" id="poly-sum-ang">0</div>
                            <div class="stat-lbl" data-i18n="lbl_sum_ang">مجموع الزوايا</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="poly-ang-err">0</div>
                            <div class="stat-lbl" data-i18n="lbl_ang_err">خطأ القفل الزاوي</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="poly-total-len">0</div>
                            <div class="stat-lbl" data-i18n="lbl_total_len">مجموع الأطوال (ΣL)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="poly-lin-err">0</div>
                            <div class="stat-lbl" data-i18n="lbl_lin_err">خطأ القفل الخطي</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="poly-err-e">0</div>
                            <div class="stat-lbl">مجموع ΔE (الجبري)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="poly-err-n">0</div>
                            <div class="stat-lbl">مجموع ΔN (الجبري)</div>
                        </div>
                    </div>

                    <h3 style="color:var(--primary); margin:25px 0 15px;" data-i18n="tbl_details">جدول الأرصاد والتصحيحات</h3>
                    <div class="table-container" id="poly-detail-table"></div>

                    <h3 style="color:var(--primary); margin:25px 0 15px;" data-i18n="graph_poly">رسم المضلع المصحح</h3>
                    <canvas id="polyCanvas" width="800" height="500"></canvas>
                    
                    <div class="export-actions">
                        <button class="btn btn-export bg-excel" onclick="exportExcel()"><i class="fa-solid fa-file-excel"></i> Excel (CSV)</button>
                        <button class="btn btn-export bg-cad" onclick="exportCAD()"><i class="fa-solid fa-file-code"></i> AutoCAD (.scr)</button>
                        <button class="btn btn-export bg-gis" onclick="exportGIS()"><i class="fa-solid fa-earth-americas"></i> ArcGIS (.txt)</button>
                    </div>
                </div>
            </div>

            <!-- قسم محول الزوايا -->
            <div id="angles" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-rotate"></i> <span data-i18n="nav_ang">محول الزوايا</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label data-i18n="lbl_val">القيمة</label>
                            <input type="text" id="ang-val" class="form-control" placeholder="e.g. 45.5 or 45 30 00">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_sys">النظام المدخل</label>
                            <select id="ang-type" class="form-control">
                                <option value="deg">Decimal Degrees</option>
                                <option value="dms">DMS (Deg min sec)</option>
                                <option value="rad">Radians</option>
                                <option value="grad">Gradians (Gon)</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calcAngles()"><i class="fa-solid fa-sync"></i> <span data-i18n="btn_convert">تحويل</span></button>
                </div>

                <div id="ang-res" class="result-panel hidden">
                    <div class="table-container">
                        <table id="angTable">
                            <thead><tr><th data-i18n="lbl_sys">System</th><th data-i18n="lbl_val">Value</th></tr></thead>
                            <tbody>
                                <tr><td>Decimal Degrees</td><td id="res-deg"></td></tr>
                                <tr><td>DMS</td><td id="res-dms"></td></tr>
                                <tr><td>Radians</td><td id="res-rad"></td></tr>
                                <tr><td>Radians (π)</td><td id="res-rad-pi" style="font-weight:bold; color:var(--primary);"></td></tr>
                                <tr><td>Gradians</td><td id="res-grad"></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- قسم أخطاء القياس (بسيطة) -->
            <div id="simple-errors" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-chart-line"></i> <span data-i18n="nav_err_s">أخطاء القياس (بسيطة)</span></h2>
                    </div>
                    <div class="form-group">
                        <label data-i18n="lbl_readings_comma">القراءات (افصل بفاصلة ,)</label>
                        <input type="text" id="sim-reads" class="form-control" placeholder="50.1, 50.2, 50.15...">
                    </div>
                    <button class="btn btn-primary" onclick="calcSimpleErrors()" style="margin-top:15px;"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">تحليل كامل</span></button>
                </div>
                
                <div id="sim-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="sim-mean">0</div><div class="stat-lbl">Mean (x̄)</div></div>
                        <div class="stat-box"><div class="stat-val" id="sim-std">0</div><div class="stat-lbl">Std Dev (σ)</div></div>
                        <div class="stat-box"><div class="stat-val" id="sim-stderr">0</div><div class="stat-lbl">Std Error (σm)</div></div>
                    </div>
                    <div id="sim-table-container" class="table-container"></div>
                    <div class="calc-steps" id="sim-steps" style="margin-top:20px;"></div>
                </div>
            </div>

            <!-- قسم أخطاء القياس (وزنية) -->
            <div id="weighted-errors" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-scale-balanced"></i> <span data-i18n="nav_err_w">أخطاء القياس (وزنية)</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group"><label data-i18n="lbl_readings">القراءات</label><input type="text" id="wei-reads" class="form-control" placeholder="50.2, 50.4"></div>
                        <div class="form-group"><label data-i18n="lbl_weights">الأوزان</label><input type="text" id="wei-vals" class="form-control" placeholder="1, 2"></div>
                    </div>
                    <button class="btn btn-primary" onclick="calcWeightedErrors()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">تحليل كامل</span></button>
                </div>
                <div id="wei-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="wei-mean">0</div><div class="stat-lbl">Weighted Mean</div></div>
                        <div class="stat-box"><div class="stat-val" id="wei-std">0</div><div class="stat-lbl">Std Unit Weight</div></div>
                    </div>
                    <div id="wei-table-container" class="table-container"></div>
                    <div class="calc-steps" id="wei-steps" style="margin-top:20px;"></div>
                </div>
            </div>

            <!-- قسم شبكة المناسيب -->
            <div id="grid-leveling" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-border-none"></i> <span data-i18n="nav_grid">شبكة المناسيب</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group">
                            <label data-i18n="lbl_rows">عدد الصفوف</label>
                            <input type="number" id="grid-rows" class="form-control" value="3" min="2">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_cols">عدد الأعمدة</label>
                            <input type="number" id="grid-cols" class="form-control" value="3" min="2">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_grid_dist">المسافة بين النقاط (m)</label>
                            <input type="number" id="grid-dist" class="form-control" value="10">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lbl_design_level">منسوب التسوية (m)</label>
                            <input type="number" id="grid-design" class="form-control" value="100">
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="generateGridInputs()"><i class="fa-solid fa-table"></i> <span data-i18n="btn_gen_table">إنشاء الجدول</span></button>
                    
                    <div id="grid-input-area" style="margin-top:20px; display:none;">
                        <h4 style="margin-bottom:10px; color:var(--text-muted);" data-i18n="lbl_enter_levels">أدخل مناسيب النقاط</h4>
                        <div class="table-container" id="grid-input-table"></div>
                        <button class="btn btn-primary" onclick="calcGridLeveling()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">حساب الكميات</span></button>
                    </div>
                </div>

                <div id="grid-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-val" id="res-grid-avg">0</div>
                            <div class="stat-lbl" data-i18n="res_avg_level">متوسط المنسوب</div>
                        </div>
                        <div class="stat-box cost-box">
                            <div class="stat-val" id="res-grid-cut">0</div>
                            <div class="stat-lbl" data-i18n="res_cut">حجم الحفر (Cut)</div>
                        </div>
                        <div class="stat-box" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                            <div class="stat-val" style="color:var(--success)" id="res-grid-fill">0</div>
                            <div class="stat-lbl" data-i18n="res_fill">حجم الردم (Fill)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="res-grid-net">0</div>
                            <div class="stat-lbl" data-i18n="res_net">الصافي (Net)</div>
                        </div>
                    </div>

                    <h3 style="color:var(--primary); margin:25px 0 15px;" data-i18n="tbl_grid_details">تفاصيل الحسابات</h3>
                    <div class="table-container" id="grid-detail-table"></div>

                    <h3 style="color:var(--primary); margin:25px 0 15px;" data-i18n="graph_grid">مخطط الشبكة</h3>
                    <canvas id="gridCanvas" width="800" height="500"></canvas>
                </div>
            </div>

            <!-- قسم جدول التسوية -->
            <div id="leveling" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-chart-line"></i> <span data-i18n="nav_leveling">جدول التسوية المساحية</span></h2>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label data-i18n="lbl_initial_bm">منسوب أول نقطة (BM - RL):</label>
                            <input type="number" id="lev_initial-bm" step="0.001" placeholder="مثال: 100.00" class="form-control">
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="level-table">
                            <thead>
                                <tr>
                                    <th>النقطة (Point)</th>
                                    <th>قراءة خلفية (BS)</th>
                                    <th>قراءة متوسطة (IS)</th>
                                    <th>قراءة أمامية (FS)</th>
                                    <th>منسوب الجهاز (HI)</th>
                                    <th>منسوب النقطة (RL)</th>
                                    <th>ملاحظات</th>
                                    <th class="no-print" style="width: 50px;">حذف</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="text" value="BM 1" class="form-control"></td>
                                    <td><input type="number" step="0.001" class="bs-input form-control"></td>
                                    <td><input type="number" step="0.001" class="is-input form-control" disabled></td>
                                    <td><input type="number" step="0.001" class="fs-input form-control" disabled></td>
                                    <td><input type="number" step="0.001" class="hi-output form-control" readonly></td>
                                    <td><input type="number" step="0.001" class="rl-output form-control" readonly></td>
                                    <td><input type="text" placeholder="ملاحظات" class="form-control"></td>
                                    <td class="no-print"></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td style="text-align: right;">المجموع الإجمالي</td>
                                    <td id="lev_sum-bs">0.000</td>
                                    <td>--</td>
                                    <td id="lev_sum-fs">0.000</td>
                                    <td>--</td>
                                    <td>--</td>
                                    <td></td>
                                    <td class="no-print"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <div style="display:flex; gap:10px; flex-wrap: wrap;">
                        <button class="btn btn-add" onclick="lev_addRow()"><i class="fa-solid fa-plus"></i> <span data-i18n="btn_add">إضافة نقطة</span></button>
                        <button class="btn btn-primary" onclick="lev_calculateLevel()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">أحسب المناسيب</span></button>
                        <button class="btn btn-export bg-excel" onclick="lev_exportToExcel()"><i class="fa-solid fa-file-excel"></i> <span>تصدير إلى Excel</span></button>
                        <button class="btn btn-secondary" onclick="window.print()"><i class="fa-solid fa-print"></i> <span>طباعة الجدول</span></button>
                        <button class="btn btn-danger" onclick="lev_resetTable()"><i class="fa-solid fa-trash"></i> <span>إعادة ضبط</span></button>
                    </div>
                    
                    <div id="lev_check-math" class="result-panel hidden">
                        <strong>التحقيق الحسابي:</strong> <span id="lev_math-check-text">...</span>
                    </div>
                </div>
            </div>

            <!-- قسم المحول الجيوديسي -->
            <div id="geodetic" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-earth-americas"></i> <span data-i18n="nav_geodetic">محول الإحداثيات الشامل</span></h2>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label>نظام الإدخال (Source System)</label>
                            <select id="geo_sourceSys" class="form-control" onchange="geo_updateLabels()">
                                <option value="JTM">JTM (Jordan Transverse Mercator)</option>
                                <option value="WGS84">WGS84 (Google Maps / GPS)</option>
                                <option value="CASSINI">Cassini (Palestine Grid)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label id="geo_lbl_x">Easting (X)</label>
                            <input type="number" id="geo_inputX" step="any" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label id="geo_lbl_y">Northing (Y)</label>
                            <input type="number" id="geo_inputY" step="any" class="form-control">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="geo_processConversion()"><i class="fa-solid fa-sync"></i> <span>تحويل الإحداثيات</span></button>
                    
                    <div id="geo-results-container" class="result-panel hidden">
                        <div id="cards-wrapper"></div>
                        
                        <div class="export-actions">
                            <button class="btn btn-export bg-gis" onclick="geo_exportKML()">
                                <i class="fa-solid fa-globe"></i> تحميل KML
                            </button>
                            <button class="btn btn-export bg-excel" onclick="geo_exportCSV()">
                                <i class="fa-solid fa-file-excel"></i> تحميل Excel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- قسم حاسبة المسافة الشطبية -->
            <div id="stadia" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-ruler-combined"></i> <span data-i18n="nav_stadia">حاسبة المسافة الأفقية</span></h2>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label>الثابت الضارب (K)</label>
                            <input type="number" id="stadia_kConst" value="100" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label>قراءة الشعرة العليا</label>
                            <input type="number" id="stadia_upper" placeholder="مثلاً: 2.500" step="0.001" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label>قراءة الشعرة السفلى</label>
                            <input type="number" id="stadia_lower" placeholder="مثلاً: 1.300" step="0.001" class="form-control">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="stadia_calcDistance()"><i class="fa-solid fa-calculator"></i> <span>احسب المسافة</span></button>
                    
                    <div id="stadia_result-box" class="result-panel hidden">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-val" id="stadia_finalResult">0.00</div>
                                <div class="stat-lbl">المسافة الصافية (متر)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- قسم محول الوحدات -->
            <div id="units" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-arrows-left-right"></i> <span data-i18n="nav_units">محول الوحدات الاحترافي</span></h2>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label>أدخل القيمة:</label>
                            <input type="number" id="unit_amount" placeholder="0" value="1" class="form-control">
                        </div>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label>من:</label>
                            <select id="unit_fromUnit" class="form-control">
                                <option value="mm">مليمتر (mm)</option>
                                <option value="cm">سنتيمتر (cm)</option>
                                <option value="m" selected>متر (m)</option>
                                <option value="km">كيلومتر (km)</option>
                                <option value="in">بوصة (inch)</option>
                                <option value="ft">قدم (ft)</option>
                                <option value="yd">ياردة (yard)</option>
                                <option value="mi">ميل (mile)</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="display: flex; align-items: center; justify-content: center;">
                            <button class="icon-btn" onclick="unit_swapUnits()" style="margin-top: 20px;"><i class="fa-solid fa-right-left"></i></button>
                        </div>
                        
                        <div class="form-group">
                            <label>إلى:</label>
                            <select id="unit_toUnit" class="form-control">
                                <option value="mm">مليمتر (mm)</option>
                                <option value="cm" selected>سنتيمتر (cm)</option>
                                <option value="m">متر (m)</option>
                                <option value="km">كيلومتر (km)</option>
                                <option value="in">بوصة (inch)</option>
                                <option value="ft">قدم (ft)</option>
                                <option value="yd">ياردة (yard)</option>
                                <option value="mi">ميل (mile)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="unit_convert()"><i class="fa-solid fa-arrows-left-right"></i> <span>تحويل الوحدات</span></button>
                    
                    <div id="unit-res" class="result-panel hidden">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-val" id="unit_output">100</div>
                                <div class="stat-lbl" id="unit_unitDisplay">سنتيمتر</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- قسم المختبر الفيزيائي -->
            <div id="physics" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-atom"></i> <span data-i18n="nav_physics">المحاسب الفيزيائي المتقدم</span></h2>
                    </div>
                    
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="phys_filterLaws('mechanics')" id="phys-btn-mech">ميكانيكا</button>
                        <button class="btn btn-secondary" onclick="phys_filterLaws('electricity')" id="phys-btn-elec">كهرباء</button>
                        <button class="btn btn-secondary" onclick="phys_filterLaws('energy')" id="phys-btn-energy">طاقة ومادة</button>
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label>اختر القانون:</label>
                            <select id="phys_lawSelector" class="form-control" onchange="phys_updateInputs()"></select>
                        </div>
                    </div>
                    
                    <div id="phys_inputsContainer" class="result-panel hidden">
                        <p style="text-align: center; color: var(--text-muted);">اختر قانوناً لعرض المدخلات</p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="phys_calculate()"><i class="fa-solid fa-calculator"></i> <span>احسب النتيجة</span></button>
                    
                    <div id="phys_resultBox" class="result-panel hidden">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-val" id="phys_outputValue">0</div>
                                <div class="stat-lbl" id="phys_outputUnit">وحدة</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- قسم القصارة -->
            <div id="plaster" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-trowel"></i> <span data-i18n="nav_plaster">حساب القصارة</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group"><label data-i18n="lbl_area">المساحة (m²)</label><input type="number" id="plas-area" class="form-control"></div>
                        <div class="form-group"><label data-i18n="lbl_thick">السمك (cm)</label><input type="number" id="plas-thick" value="2" class="form-control"></div>
                        <div class="form-group"><label data-i18n="lbl_ratio">نسبة الخلط</label>
                            <select id="plas-ratio" class="form-control"><option value="4">1:4</option><option value="3">1:3</option><option value="5">1:5</option></select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calcPlaster()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">احسب المواد</span></button>
                </div>
                <div id="plas-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="plas-cem">0</div><div class="stat-lbl" data-i18n="res_cem_bags">أسمنت (أكياس)</div></div>
                        <div class="stat-box"><div class="stat-val" id="plas-sand">0</div><div class="stat-lbl" data-i18n="res_sand_m3">رمل (m³)</div></div>
                    </div>
                    <div class="calc-steps" id="plas-steps"></div>
                </div>
            </div>

            <!-- قسم الطوب -->
            <div id="brick" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-cubes-stacked"></i> <span data-i18n="nav_brick">حساب الطوب</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group"><label data-i18n="lbl_wall_area">مساحة الحائط (m²)</label><input type="number" id="brk-area" class="form-control" placeholder="50"></div>
                        <div class="form-group"><label data-i18n="lbl_len">طول الطوبة (L) - cm</label><input type="number" id="brk-len" value="40" class="form-control"></div>
                        <div class="form-group"><label data-i18n="lbl_height">ارتفاع الطوبة (H) - cm</label><input type="number" id="brk-hgt" value="20" class="form-control"></div>
                    </div>
                    <button class="btn btn-primary" onclick="calcBrick()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">احسب الكميات</span></button>
                </div>
                <div id="brk-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="brk-count">0</div><div class="stat-lbl" data-i18n="res_brick_count">عدد الطوب المطلوب</div></div>
                    </div>
                    <div class="calc-steps" id="brk-steps"></div>
                </div>
            </div>

            <!-- قسم البلاط -->
            <div id="tiles" class="page">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-border-all"></i> <span data-i18n="nav_tile">حساب البلاط</span></h2>
                    </div>
                    <div class="input-grid">
                        <div class="form-group"><label data-i18n="lbl_tile_area">مساحة البلاط (m²)</label><input type="number" id="tile-area" class="form-control"></div>
                        <div class="form-group"><label data-i18n="lbl_tile_len">طول البلاطة (cm)</label><input type="number" id="tile-len" class="form-control" placeholder="60"></div>
                        <div class="form-group"><label data-i18n="lbl_tile_wid">عرض البلاطة (cm)</label><input type="number" id="tile-wid" class="form-control" placeholder="60"></div>
                        <div class="form-group"><label data-i18n="lbl_mortar_thick">سمك المونة (cm)</label><input type="number" id="tile-mortar" value="2.5" class="form-control"></div>
                        <div class="form-group"><label data-i18n="lbl_adas_thick">سمك العدسية (cm)</label><input type="number" id="tile-adas" value="8" class="form-control"></div>
                    </div>
                    <button class="btn btn-primary" onclick="calcTiles()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">احسب الكميات</span></button>
                </div>
                <div id="tile-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="res-tile-count">0</div><div class="stat-lbl" data-i18n="res_tile_pcs">عدد البلاط</div></div>
                        <div class="stat-box"><div class="stat-val" id="res-tile-cement">0</div><div class="stat-lbl" data-i18n="res_cem_bags">أسمنت (أكياس)</div></div>
                        <div class="stat-box"><div class="stat-val" id="res-tile-sand">0</div><div class="stat-lbl" data-i18n="res_sand_m3">رمل (m³)</div></div>
                        <div class="stat-box"><div class="stat-val" id="res-tile-adas">0</div><div class="stat-lbl" data-i18n="res_adas_m3">عدسية (m³)</div></div>
                    </div>
                    <div class="calc-steps" id="tile-steps"></div>
                </div>
            </div>

            <!-- قسم الخرسانة -->
            <div id="concrete" class="page">
                <div class="card">
                    <div class="section-header"><h2><i class="fa-solid fa-truck-mixer"></i> <span data-i18n="nav_conc">خرسانة</span></h2></div>
                    <p data-i18n="soon">قريباً - Coming Soon</p>
                </div>
            </div>

            <!-- قسم الأشكال 2D -->
            <div id="geo-2d" class="page">
                <div class="card">
                    <div class="section-header"><h2><i class="fa-regular fa-square"></i> <span data-i18n="nav_g2d">أشكال ثنائية الأبعاد (2D)</span></h2></div>
                    <div id="g2d-menu" class="shape-grid"></div>
                    <div id="g2d-workspace" class="hidden">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 id="g2d-title" style="color:var(--primary); margin:0;"></h3>
                            <button class="btn btn-secondary btn-sm" onclick="showG2DMenu()">🔙 <span data-i18n="btn_back">عودة</span></button>
                        </div>
                        <div id="g2d-inputs" class="input-grid"></div>
                        <button class="btn btn-primary" onclick="calcG2D()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">احسب وارسم</span></button>
                    </div>
                </div>
                <div id="g2d-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="res-g2d-area">0</div><div class="stat-lbl" data-i18n="lbl_area">المساحة</div></div>
                        <div class="stat-box"><div class="stat-val" id="res-g2d-perim">0</div><div class="stat-lbl" data-i18n="lbl_perim">المحيط</div></div>
                        <div class="stat-box hidden" id="card-g2d-hyp"><div class="stat-val" id="res-g2d-hyp">0</div><div class="stat-lbl" id="lbl-g2d-hyp">الوتر</div></div>
                    </div>
                    <canvas id="canvas2d" width="700" height="500"></canvas>
                </div>
            </div>

            <!-- قسم المجسمات 3D -->
            <div id="geo-3d" class="page">
                <div class="card">
                    <div class="section-header"><h2><i class="fa-solid fa-cube"></i> <span data-i18n="nav_g3d">مجسمات ثلاثية الأبعاد (3D)</span></h2></div>
                    <div id="g3d-menu" class="shape-grid"></div>
                    <div id="g3d-workspace" class="hidden">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 id="g3d-title" style="color:var(--primary); margin:0;"></h3>
                            <button class="btn btn-secondary btn-sm" onclick="showG3DMenu()">🔙 <span data-i18n="btn_back">عودة</span></button>
                        </div>
                        <div id="g3d-inputs" class="input-grid"></div>
                        <button class="btn btn-primary" onclick="calcG3D()"><i class="fa-solid fa-calculator"></i> <span data-i18n="btn_calc">احسب وارسم</span></button>
                    </div>
                </div>
                <div id="g3d-res" class="result-panel hidden">
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-val" id="res-g3d-vol">0</div><div class="stat-lbl" data-i18n="lbl_vol">الحجم</div></div>
                        <div class="stat-box"><div class="stat-val" id="res-g3d-surf">0</div><div class="stat-lbl" data-i18n="lbl_surf">المساحة السطحية</div></div>
                    </div>
                    <canvas id="canvas3d" width="700" height="500"></canvas>
                </div>
            </div>

        </div>
    </div>

    <!-- مكتبة Proj4JS للتحويل الجيوديسي -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>
    <script src="script.js"></script>
</body>
</html>